(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{D:()=>J,B:()=>N}),document.forms.element__form;var t=document.querySelector(".popup-img"),n=(document.querySelector(".popup"),document.querySelector(".mesto")),o=document.querySelector("#element-template").content,r=document.querySelector(".popup__input_name"),c=document.querySelector(".popup__input_info"),a=document.querySelector(".profile__avatar"),u=document.querySelector(".profile__subtitle"),i=document.querySelector(".popup__form"),s=document.querySelector(".profile__edit-button"),l=document.querySelector(".popup-edit"),d=document.querySelector(".profile__title"),m=document.querySelector(".mesto__form"),f=document.querySelector(".profile__add-button"),_=(document.querySelector(".page"),document.querySelector(".elements")),p=document.querySelector(".mesto__input_first"),v=document.querySelector(".mesto__input_second"),y=t.querySelector(".popup-img__image"),h=(document.querySelector(".popup-img__close-img"),t.querySelector(".popup-img__title")),S=document.querySelector(".popup-delete"),b=S.querySelector(".form__uni"),q=document.querySelector(".profile__avatar-block"),E=document.querySelector(".popup-avatar"),C=E.querySelector(".form__uni"),L=document.querySelector("#avatar-link");function g(e){e.classList.add("popup_opened"),document.addEventListener("keydown",B),document.addEventListener("mousedown",x)}function k(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",B),document.removeEventListener("mousedown",x)}function x(e){(e.target.classList.contains("popup__close")||e.target.classList.contains("popup"))&&k(document.querySelector(".popup_opened"))}function B(e){"Escape"===e.key&&k(document.querySelector(".popup_opened"))}function U(e,n,r,c,a,u){var i=function(e,n,r,c,a,u){var i=o.querySelector(".element").cloneNode(!0),s=i.querySelector(".element__title"),l=i.querySelector(".element__img"),d=i.querySelector(".element__vector"),m=i.querySelector(".element__vector_counter"),f=i.querySelector(".element__korzina");return s.textContent=e,l.src=n,l.alt=e,d.addEventListener("click",D),a===u?f.addEventListener("click",A):f.remove(),l.addEventListener("click",(function(){return function(e,n){h.textContent=e,y.src=n,y.alt=e,g(t)}(e,n)})),i.id=r,m.textContent=c.length,c.some((function(e){return e._id===u}))&&d.classList.add("element__vector_active"),i}(e,n,r,c,a,u);_.prepend(i)}function A(e){S.dataset.deletedElement=e.target.closest(".element").id,g(S)}function D(e){e.target.classList.contains("element__vector_active")?J(e.target.closest(".element").id):N(e.target.closest(".element").id)}function P(e,t){document.getElementById(e).querySelector(".element__vector_counter").textContent=t}var w,O,T=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.removeAttribute("disabled",!0)):(t.classList.add(n),t.setAttribute("disabled",!0))},j={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-15",headers:{authorization:"ba6097cc-c5ae-47eb-ae48-050b54337db7","Content-Type":"application/json"}};function I(e){return e.ok?e.json():Promise.reject("Код ошибки: ".concat(e.status))}function N(e){var t;(t=e,fetch("".concat(j.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:j.headers}).then(I)).then((function(t){document.getElementById(e).querySelector(".element__vector").classList.add("element__vector_active"),P(e,t.likes.length)})).catch((function(e){console.error("Ошибка при сохранении лайка на сервере.",e)}))}function J(e){var t;(t=e,fetch("".concat(j.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:j.headers}).then(I)).then((function(t){document.getElementById(e).querySelector(".element__vector").classList.remove("element__vector_active"),P(e,t.likes.length)})).catch((function(e){console.error("Ошибка при удалении лайка на сервере.",e)}))}Promise.all([fetch("".concat(j.baseUrl,"/users/me"),{headers:j.headers}).then(I),fetch("".concat(j.baseUrl,"/cards"),{headers:j.headers}).then(I)]).then((function(e){d.textContent=e[0].name,u.textContent=e[0].about,a.src=e[0].avatar,w=e[0]._id,e[1].forEach((function(e){U(e.name,e.link,e._id,e.likes,e.owner._id,w)}))})).catch((function(e){console.error("Ошибка при загрузке данных с сервера.",e)})),q.addEventListener("click",(function(){g(E)})),O={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit",inactiveButtonClass:"button_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},Array.from(document.querySelectorAll(O.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);T(n,o,t.inactiveButtonClass),n.forEach((function(r){r.addEventListener("input",(function(){T(n,o,t.inactiveButtonClass),function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t)}))}))}(e,O)})),s.addEventListener("click",(function(){g(l),r.value=d.textContent,c.value=u.textContent})),f.addEventListener("click",(function(){var e;g(n),(e=document.querySelector(".mesto__add")).setAttribute("disabled",!0),e.classList.add("button_inactive")})),i.addEventListener("submit",(function(e){var t,n;e.preventDefault(),e.submitter.textContent="Сохранение...",(t=r.value,n=c.value,fetch("".concat(j.baseUrl,"/users/me"),{method:"PATCH",headers:j.headers,body:JSON.stringify({name:t,about:n})}).then(I)).then((function(){d.textContent=r.value,u.textContent=c.value,k(l)})).catch((function(e){console.error("Ошибка при сохранении профиля.",e)})).finally((function(){e.submitter.textContent="Сохранить"}))})),m.addEventListener("submit",(function(e){var t,o;e.preventDefault(),e.submitter.textContent="Сохранение...",(t=p.value,o=v.value,fetch("".concat(j.baseUrl,"/cards"),{method:"POST",headers:j.headers,body:JSON.stringify({name:t,link:o})}).then(I)).then((function(e){U(p.value,v.value,e._id,[],e.owner._id,w),k(n)})).catch((function(e){console.error("Ошибка при сохранении профиля.",e)})).finally((function(){e.submitter.textContent="Создать",e.target.reset()}))})),b.addEventListener("submit",(function(e){var t;e.preventDefault(),e.submitter.textContent="Удаление...",(t=S.dataset.deletedElement,fetch("".concat(j.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:j.headers}).then(I)).then((function(){document.getElementById(S.dataset.deletedElement).remove(),k(S)})).catch((function(e){console.error("Ошибка при удалении карточки.",e)})).finally((function(){e.submitter.textContent="Да",S.dataset.deletedElement=""}))})),C.addEventListener("submit",(function(e){var t;e.preventDefault(),e.submitter.textContent="Сохранение...",(t=L.value,fetch("".concat(j.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:j.headers,body:JSON.stringify({avatar:t})}).then(I)).then((function(e){a.src=e.avatar,k(E)})).catch((function(e){console.error("Ошибка при загрузке нового аватара.",e)})).finally((function(){e.submitter.textContent="Сохранить",e.target.reset()}))}))})();